<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Scheduling Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --accent-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --gray-color: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--dark-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .header p {
            color: var(--gray-color);
            font-size: 1.1rem;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-color);
        }

        /* Input Section */
        .process-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .process-form {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #e5940a;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-block {
            width: 100%;
        }

        /* Process Table */
        .process-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .process-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .process-table th {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .process-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .process-table tbody tr:hover {
            background: #f8fafc;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 0 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .action-btn.edit {
            background: var(--warning-color);
            color: white;
        }

        .action-btn.delete {
            background: var(--danger-color);
            color: white;
        }

        /* Algorithm Controls */
        .algorithm-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .algorithm-controls {
                grid-template-columns: 1fr;
            }
        }

        .algorithm-select {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        /* Time Quantum Input */
        .time-quantum-group {
            display: none;
            align-items: center;
            gap: 10px;
        }

        .time-quantum-group.show {
            display: flex;
        }

        /* Gantt Chart */
        .gantt-chart-container {
            margin-top: 20px;
            overflow-x: auto;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .gantt-chart {
            display: flex;
            align-items: center;
            min-height: 120px;
            position: relative;
        }

        .gantt-process {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            border-radius: 6px;
            margin: 5px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .gantt-process:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .gantt-process.idle {
            background: #9ca3af;
        }

        .gantt-timeline {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px 0;
            border-top: 2px solid var(--border-color);
        }

        .time-marker {
            position: relative;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .time-marker::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 8px;
            background: var(--gray-color);
        }

        /* Metrics Dashboard */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .metric-label {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        /* Process Details Table */
        .details-table-container {
            margin-top: 20px;
            overflow-x: auto;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
        }

        .details-table th {
            background: #f1f5f9;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 2px solid var(--border-color);
        }

        .details-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .details-table tr:nth-child(even) {
            background: #f8fafc;
        }

        /* Comparison Section */
        .comparison-section {
            margin-top: 40px;
        }

        .comparison-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .comparison-bar {
            flex: 1;
            background: var(--primary-color);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }

        .comparison-bar-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .comparison-bar-value {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: var(--dark-color);
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease;
        }

        /* Color classes for processes */
        .color-1 { background: #3b82f6; }
        .color-2 { background: #10b981; }
        .color-3 { background: #8b5cf6; }
        .color-4 { background: #f59e0b; }
        .color-5 { background: #ef4444; }
        .color-6 { background: #06b6d4; }
        .color-7 { background: #ec4899; }
        .color-8 { background: #84cc16; }
        .color-9 { background: #f97316; }
        .color-10 { background: #6366f1; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .process-form {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px 15px;
            }
            
            .comparison-chart {
                flex-direction: column;
                height: auto;
                align-items: stretch;
            }
            
            .comparison-bar {
                height: 40px !important;
                width: 100%;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-microchip"></i> CPU Scheduling Simulator</h1>
            <p>Visualize and compare different CPU scheduling algorithms in real-time</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column: Input & Controls -->
            <div class="left-column">
                <!-- Process Input Card -->
                <div class="card animate-fadeIn">
                    <h2 class="card-title"><i class="fas fa-plus-circle"></i> Add Processes</h2>
                    
                    <form id="processForm" class="process-form">
                        <div class="form-group">
                            <label for="processId">Process ID</label>
                            <input type="text" id="processId" class="form-control" placeholder="e.g., P1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="arrivalTime">Arrival Time</label>
                            <input type="number" id="arrivalTime" class="form-control" placeholder="0" min="0" value="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="burstTime">Burst Time</label>
                            <input type="number" id="burstTime" class="form-control" placeholder="e.g., 5" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="priority">Priority</label>
                            <input type="number" id="priority" class="form-control" placeholder="1" min="1" value="1">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Process
                        </button>
                    </form>
                    
                    <!-- Process Table -->
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>Process ID</th>
                                    <th>Arrival Time</th>
                                    <th>Burst Time</th>
                                    <th>Priority</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="processTableBody">
                                <!-- Processes will be added here dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="clearAllBtn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                        <button id="generateRandomBtn" class="btn btn-warning">
                            <i class="fas fa-random"></i> Generate Random
                        </button>
                        <button id="loadSampleBtn" class="btn btn-success">
                            <i class="fas fa-vial"></i> Load Sample
                        </button>
                    </div>
                </div>

                <!-- Algorithm Controls Card -->
                <div class="card animate-fadeIn" style="margin-top: 30px;">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> Algorithm Configuration</h2>
                    
                    <div class="algorithm-controls">
                        <div class="form-group">
                            <label for="algorithmSelect">Scheduling Algorithm</label>
                            <select id="algorithmSelect" class="algorithm-select">
                                <option value="fcfs">FCFS (First Come First Served)</option>
                                <option value="sjf">SJF (Shortest Job First)</option>
                                <option value="roundRobin">Round Robin</option>
                                <option value="priority">Priority Scheduling</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="timeQuantum">Time Quantum (for Round Robin)</label>
                            <div class="time-quantum-group" id="timeQuantumGroup">
                                <input type="number" id="timeQuantum" class="form-control" placeholder="2" min="1" value="2">
                                <span>units</span>
                            </div>
                            <p style="color: var(--gray-color); font-size: 0.9rem; margin-top: 5px;" id="quantumInfo">
                                Only applicable for Round Robin algorithm
                            </p>
                        </div>
                    </div>
                    
                    <button id="simulateBtn" class="btn btn-primary btn-block" style="margin-top: 20px;">
                        <i class="fas fa-play-circle"></i> Run Simulation
                    </button>
                    
                    <button id="compareAllBtn" class="btn btn-success btn-block" style="margin-top: 10px;">
                        <i class="fas fa-chart-bar"></i> Compare All Algorithms
                    </button>
                </div>
            </div>

            <!-- Right Column: Visualization & Results -->
            <div class="right-column">
                <!-- Results Card -->
                <div class="card animate-fadeIn">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Simulation Results</h2>
                    
                    <div id="resultsContainer">
                        <!-- Results will be loaded here -->
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Simulation Results Yet</h3>
                            <p>Add processes and run a simulation to see results</p>
                        </div>
                    </div>
                </div>

                <!-- Gantt Chart Card -->
                <div class="card animate-fadeIn" style="margin-top: 30px;">
                    <h2 class="card-title"><i class="fas fa-project-diagram"></i> Gantt Chart</h2>
                    
                    <div id="ganttChartContainer">
                        <!-- Gantt chart will be rendered here -->
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-stream" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Gantt Chart Available</h3>
                            <p>Run a simulation to generate the Gantt chart</p>
                        </div>
                    </div>
                </div>

                <!-- Comparison Card -->
                <div class="card animate-fadeIn comparison-section">
                    <h2 class="card-title"><i class="fas fa-balance-scale"></i> Algorithm Comparison</h2>
                    
                    <div id="comparisonContainer">
                        <!-- Comparison chart will be rendered here -->
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Comparison Data</h3>
                            <p>Click "Compare All Algorithms" to see performance comparison</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>CPU Scheduling Simulator &copy; 2024 | Educational Tool for Operating Systems</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">
                <i class="fas fa-code"></i> Built with HTML, CSS, and JavaScript
            </p>
        </div>
    </div>

    <!-- JavaScript Implementation -->
    <script>
        // ============================================
        // 1. STATE MANAGEMENT
        // ============================================
        class AppState {
            constructor() {
                this.processes = [];
                this.currentAlgorithm = 'fcfs';
                this.timeQuantum = 2;
                this.results = null;
                this.comparisonResults = null;
                this.processCounter = 1;
                this.editIndex = -1; // -1 means not editing
                
                // Load saved data if available
                this.loadFromLocalStorage();
            }
            
            addProcess(process) {
                this.processes.push(process);
                this.saveToLocalStorage();
            }
            
            updateProcess(index, process) {
                this.processes[index] = process;
                this.saveToLocalStorage();
            }
            
            removeProcess(index) {
                this.processes.splice(index, 1);
                this.saveToLocalStorage();
            }
            
            clearAllProcesses() {
                this.processes = [];
                this.saveToLocalStorage();
            }
            
            generateRandomProcesses(count = 5) {
                this.processes = [];
                for (let i = 1; i <= count; i++) {
                    this.processes.push({
                        id: `P${i}`,
                        arrivalTime: Math.floor(Math.random() * 5),
                        burstTime: Math.floor(Math.random() * 10) + 1,
                        priority: Math.floor(Math.random() * 5) + 1
                    });
                }
                this.saveToLocalStorage();
            }
            
            loadSampleProcesses() {
                this.processes = [
                    { id: 'P1', arrivalTime: 0, burstTime: 8, priority: 3 },
                    { id: 'P2', arrivalTime: 1, burstTime: 4, priority: 2 },
                    { id: 'P3', arrivalTime: 2, burstTime: 9, priority: 4 },
                    { id: 'P4', arrivalTime: 3, burstTime: 5, priority: 1 },
                    { id: 'P5', arrivalTime: 4, burstTime: 2, priority: 5 }
                ];
                this.saveToLocalStorage();
            }
            
            saveToLocalStorage() {
                const data = {
                    processes: this.processes,
                    timeQuantum: this.timeQuantum,
                    currentAlgorithm: this.currentAlgorithm
                };
                localStorage.setItem('cpuSchedulingData', JSON.stringify(data));
            }
            
            loadFromLocalStorage() {
                const saved = localStorage.getItem('cpuSchedulingData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.processes = data.processes || [];
                    this.timeQuantum = data.timeQuantum || 2;
                    this.currentAlgorithm = data.currentAlgorithm || 'fcfs';
                }
            }
        }

        // ============================================
        // 2. UI COMPONENTS
        // ============================================
        class UIComponents {
            constructor() {
                this.state = new AppState();
                this.bindEvents();
                this.renderProcessTable();
                this.updateAlgorithmUI();
            }
            
            bindEvents() {
                // Form submission
                document.getElementById('processForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAddProcess();
                });
                
                // Algorithm selection
                document.getElementById('algorithmSelect').addEventListener('change', (e) => {
                    this.state.currentAlgorithm = e.target.value;
                    this.state.saveToLocalStorage();
                    this.updateAlgorithmUI();
                });
                
                // Time quantum input
                document.getElementById('timeQuantum').addEventListener('change', (e) => {
                    this.state.timeQuantum = parseInt(e.target.value);
                    this.state.saveToLocalStorage();
                });
                
                // Action buttons
                document.getElementById('clearAllBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear all processes?')) {
                        this.state.clearAllProcesses();
                        this.renderProcessTable();
                        this.clearResults();
                    }
                });
                
                document.getElementById('generateRandomBtn').addEventListener('click', () => {
                    this.state.generateRandomProcesses(5);
                    this.renderProcessTable();
                });
                
                document.getElementById('loadSampleBtn').addEventListener('click', () => {
                    this.state.loadSampleProcesses();
                    this.renderProcessTable();
                });
                
                document.getElementById('simulateBtn').addEventListener('click', () => {
                    this.runSimulation();
                });
                
                document.getElementById('compareAllBtn').addEventListener('click', () => {
                    this.compareAllAlgorithms();
                });
            }
            
            handleAddProcess() {
                const id = document.getElementById('processId').value.trim();
                const arrivalTime = parseInt(document.getElementById('arrivalTime').value);
                const burstTime = parseInt(document.getElementById('burstTime').value);
                const priority = parseInt(document.getElementById('priority').value) || 1;
                
                // Validate inputs
                if (!id) {
                    alert('Please enter a process ID');
                    return;
                }
                
                if (isNaN(arrivalTime) || arrivalTime < 0) {
                    alert('Arrival time must be a non-negative number');
                    return;
                }
                
                if (isNaN(burstTime) || burstTime <= 0) {
                    alert('Burst time must be a positive number');
                    return;
                }
                
                if (isNaN(priority) || priority <= 0) {
                    alert('Priority must be a positive number');
                    return;
                }
                
                const process = { id, arrivalTime, burstTime, priority };
                
                if (this.state.editIndex === -1) {
                    // Add new process
                    this.state.addProcess(process);
                } else {
                    // Update existing process
                    this.state.updateProcess(this.state.editIndex, process);
                    this.state.editIndex = -1;
                    document.getElementById('processForm').querySelector('button[type="submit"]').innerHTML = 
                        '<i class="fas fa-plus"></i> Add Process';
                }
                
                // Clear form
                document.getElementById('processForm').reset();
                document.getElementById('arrivalTime').value = '0';
                document.getElementById('priority').value = '1';
                
                // Update UI
                this.renderProcessTable();
            }
            
            renderProcessTable() {
                const tbody = document.getElementById('processTableBody');
                tbody.innerHTML = '';
                
                if (this.state.processes.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray-color);">
                                <i class="fas fa-list-ul" style="font-size: 2rem; opacity: 0.5; margin-bottom: 10px;"></i>
                                <p>No processes added yet</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                this.state.processes.forEach((process, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${process.id}</td>
                        <td>${process.arrivalTime}</td>
                        <td>${process.burstTime}</td>
                        <td>${process.priority}</td>
                        <td>
                            <button class="action-btn edit" onclick="ui.editProcess(${index})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="ui.deleteProcess(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            editProcess(index) {
                const process = this.state.processes[index];
                document.getElementById('processId').value = process.id;
                document.getElementById('arrivalTime').value = process.arrivalTime;
                document.getElementById('burstTime').value = process.burstTime;
                document.getElementById('priority').value = process.priority;
                
                this.state.editIndex = index;
                document.getElementById('processForm').querySelector('button[type="submit"]').innerHTML = 
                    '<i class="fas fa-save"></i> Update Process';
                
                // Scroll to form
                document.getElementById('processForm').scrollIntoView({ behavior: 'smooth' });
            }
            
            deleteProcess(index) {
                if (confirm('Are you sure you want to delete this process?')) {
                    this.state.removeProcess(index);
                    this.renderProcessTable();
                    this.clearResults();
                }
            }
            
            updateAlgorithmUI() {
                const algorithm = document.getElementById('algorithmSelect').value;
                const quantumGroup = document.getElementById('timeQuantumGroup');
                const quantumInfo = document.getElementById('quantumInfo');
                
                // Update algorithm description
                const descriptions = {
                    'fcfs': 'Processes are executed in order of arrival. Simple but may cause convoy effect.',
                    'sjf': 'Process with shortest burst time runs next. Minimizes average waiting time.',
                    'roundRobin': 'Each process gets a fixed time slice (quantum). Good for time-sharing systems.',
                    'priority': 'Processes with higher priority (lower number) run first. May cause starvation.'
                };
                
                quantumInfo.innerHTML = descriptions[algorithm] || '';
                
                // Show/hide time quantum input
                if (algorithm === 'roundRobin') {
                    quantumGroup.classList.add('show');
                } else {
                    quantumGroup.classList.remove('show');
                }
                
                // Update time quantum value
                document.getElementById('timeQuantum').value = this.state.timeQuantum;
            }
            
            showLoading(containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div class="spinner"></div>
                        <p style="margin-top: 20px; color: var(--gray-color);">Calculating schedule...</p>
                    </div>
                `;
            }
            
            clearResults() {
                document.getElementById('resultsContainer').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>No Simulation Results Yet</h3>
                        <p>Add processes and run a simulation to see results</p>
                    </div>
                `;
                
                document.getElementById('ganttChartContainer').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                        <i class="fas fa-stream" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>No Gantt Chart Available</h3>
                        <p>Run a simulation to generate the Gantt chart</p>
                    </div>
                `;
            }
        }

        // ============================================
        // 3. VISUALIZATION RENDERER
        // ============================================
        class VisualizationRenderer {
            constructor() {
                this.colorMap = new Map();
                this.colorClasses = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5', 
                                     'color-6', 'color-7', 'color-8', 'color-9', 'color-10'];
            }
            
            getProcessColor(processId) {
                if (!this.colorMap.has(processId)) {
                    const colorIndex = this.colorMap.size % this.colorClasses.length;
                    this.colorMap.set(processId, this.colorClasses[colorIndex]);
                }
                return this.colorMap.get(processId);
            }
            
            renderGanttChart(ganttChart, containerId) {
                const container = document.getElementById(containerId);
                
                if (!ganttChart || ganttChart.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <h3>No Gantt Chart Data</h3>
                            <p>Could not generate Gantt chart for the given processes</p>
                        </div>
                    `;
                    return;
                }
                
                // Calculate total time
                const totalTime = ganttChart[ganttChart.length - 1].endTime;
                
                // Create Gantt chart HTML
                let html = `
                    <div class="gantt-chart" style="height: 100px; position: relative;">
                `;
                
                // Create process bars
                ganttChart.forEach(entry => {
                    const width = ((entry.endTime - entry.startTime) / totalTime) * 100;
                    const left = (entry.startTime / totalTime) * 100;
                    const colorClass = entry.processId === 'Idle' ? 'idle' : this.getProcessColor(entry.processId);
                    
                    html += `
                        <div class="gantt-process ${colorClass}" 
                             style="width: ${width}%; left: ${left}%;"
                             title="Process: ${entry.processId}, Time: ${entry.startTime}-${entry.endTime}">
                            ${entry.processId === 'Idle' ? 'IDLE' : entry.processId}
                            <div style="position: absolute; bottom: -20px; left: 0; right: 0; text-align: center; font-size: 0.8rem;">
                                ${entry.startTime}
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                
                // Create timeline
                html += `<div class="gantt-timeline">`;
                for (let i = 0; i <= totalTime; i += Math.max(1, Math.floor(totalTime / 10))) {
                    html += `<div class="time-marker" style="flex: 1; text-align: center;">${i}</div>`;
                }
                html += `</div>`;
                
                container.innerHTML = html;
            }
            
            renderMetrics(metrics, containerId) {
                const container = document.getElementById(containerId);
                
                let html = `
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value">${metrics.averageWaitingTime.toFixed(2)}</div>
                            <div class="metric-label">Average Waiting Time</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${metrics.averageTurnaroundTime.toFixed(2)}</div>
                            <div class="metric-label">Average Turnaround Time</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${metrics.averageResponseTime?.toFixed(2) || 'N/A'}</div>
                            <div class="metric-label">Average Response Time</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${metrics.throughput.toFixed(3)}</div>
                            <div class="metric-label">Throughput</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${metrics.cpuUtilization}%</div>
                            <div class="metric-label">CPU Utilization</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${metrics.totalTime}</div>
                            <div class="metric-label">Total Time Units</div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            renderProcessDetails(processes, containerId) {
                const container = document.getElementById(containerId);
                
                if (!processes || processes.length === 0) {
                    container.innerHTML = '<p>No process details available</p>';
                    return;
                }
                
                let html = `
                    <div class="details-table-container">
                        <table class="details-table">
                            <thead>
                                <tr>
                                    <th>Process ID</th>
                                    <th>Arrival</th>
                                    <th>Burst</th>
                                    <th>Priority</th>
                                    <th>Start Time</th>
                                    <th>Completion</th>
                                    <th>Waiting</th>
                                    <th>Turnaround</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                processes.forEach(process => {
                    html += `
                        <tr>
                            <td>${process.id}</td>
                            <td>${process.arrivalTime}</td>
                            <td>${process.burstTime}</td>
                            <td>${process.priority}</td>
                            <td>${process.startTime >= 0 ? process.startTime : '-'}</td>
                            <td>${process.completionTime || '-'}</td>
                            <td>${process.waitingTime || '-'}</td>
                            <td>${process.turnaroundTime || '-'}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody></table></div>`;
                container.innerHTML = html;
            }
            
            renderComparison(comparisonData, containerId) {
                const container = document.getElementById(containerId);
                
                if (!comparisonData || !comparisonData.comparison || !comparisonData.comparison.allAlgorithms) {
                    container.innerHTML = '<p>No comparison data available</p>';
                    return;
                }
                
                const algorithms = comparisonData.comparison.allAlgorithms;
                const maxWaitingTime = Math.max(...algorithms.map(a => a.averageWaitingTime));
                
                let html = `
                    <div class="comparison-chart" style="height: 300px;">
                `;
                
                algorithms.forEach(algo => {
                    const height = (algo.averageWaitingTime / maxWaitingTime) * 80;
                    html += `
                        <div class="comparison-bar" 
                             style="height: ${height}%; background: ${this.getBarColor(algo.name)}">
                            <div class="comparison-bar-value">${algo.averageWaitingTime.toFixed(2)}</div>
                            <div class="comparison-bar-label">${algo.name}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                
                // Add summary
                html += `
                    <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Algorithm Comparison Summary</h3>
                        <p><strong>Best Algorithm for Waiting Time:</strong> ${comparisonData.comparison.bestAlgorithm}</p>
                        <p><strong>Best Waiting Time:</strong> ${comparisonData.comparison.bestWaitingTime.toFixed(2)} units</p>
                        <p style="margin-top: 10px; font-style: italic; color: var(--gray-color);">
                            ${comparisonData.comparison.recommendation}
                        </p>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            getBarColor(algorithmName) {
                const colors = {
                    'FCFS': '#3b82f6',
                    'SJF': '#10b981',
                    'ROUND ROBIN': '#8b5cf6',
                    'PRIORITY': '#f59e0b'
                };
                return colors[algorithmName] || '#6b7280';
            }
            
            renderResults(result, containerId) {
                const container = document.getElementById(containerId);
                
                let html = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-calculator"></i> ${result.algorithmName}
                            ${result.timeQuantum ? `<span style="font-size: 0.9rem; background: var(--accent-color); color: white; padding: 3px 10px; border-radius: 20px;">Quantum: ${result.timeQuantum}</span>` : ''}
                        </h3>
                        <p style="color: var(--gray-color); margin-top: 5px;">Simulation completed successfully</p>
                    </div>
                `;
                
                container.innerHTML = html;
                
                // Render metrics
                this.renderMetrics(result.getMetrics(), containerId);
                
                // Add process details section
                html = `
                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px; color: var(--dark-color);">
                            <i class="fas fa-list-alt"></i> Process Details
                        </h4>
                `;
                container.innerHTML += html;
                
                // Render process details
                this.renderProcessDetails(result.getProcessDetails(), containerId);
            }
        }

        // ============================================
        // 4. SIMULATION CONTROLLER
        // ============================================
        class SimulationController {
            constructor() {
                this.ui = new UIComponents();
                this.visualizer = new VisualizationRenderer();
            }
            
            async runSimulation() {
                // Validate that we have processes
                if (this.ui.state.processes.length === 0) {
                    alert('Please add at least one process before running simulation');
                    return;
                }
                
                // Show loading
                this.ui.showLoading('resultsContainer');
                this.ui.showLoading('ganttChartContainer');
                
                // Get algorithm and parameters
                const algorithm = this.ui.state.currentAlgorithm;
                const timeQuantum = algorithm === 'roundRobin' ? this.ui.state.timeQuantum : null;
                
                try {
                    // Convert processes to CPUScheduling Process objects
                    const processes = this.ui.state.processes.map(p => 
                        new CPUScheduling.Process(p.id, p.arrivalTime, p.burstTime, p.priority)
                    );
                    
                    // Run simulation
                    let result;
                    switch (algorithm) {
                        case 'fcfs':
                            result = CPUScheduling.FCFSScheduler.schedule(processes);
                            break;
                        case 'sjf':
                            result = CPUScheduling.SJFScheduler.schedule(processes);
                            break;
                        case 'roundRobin':
                            result = CPUScheduling.RoundRobinScheduler.schedule(processes, timeQuantum);
                            break;
                        case 'priority':
                            result = CPUScheduling.PriorityScheduler.schedule(processes);
                            break;
                        default:
                            throw new Error(`Unknown algorithm: ${algorithm}`);
                    }
                    
                    // Store results
                    this.ui.state.results = result;
                    
                    // Render results
                    this.visualizer.renderResults(result, 'resultsContainer');
                    this.visualizer.renderGanttChart(result.getGanttChart(), 'ganttChartContainer');
                    
                    // Clear comparison container
                    document.getElementById('comparisonContainer').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Comparison Data</h3>
                            <p>Click "Compare All Algorithms" to see performance comparison</p>
                        </div>
                    `;
                    
                } catch (error) {
                    console.error('Simulation error:', error);
                    alert(`Error running simulation: ${error.message}`);
                    
                    // Show error state
                    document.getElementById('resultsContainer').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <h3>Simulation Error</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
            
            async compareAllAlgorithms() {
                // Validate that we have processes
                if (this.ui.state.processes.length === 0) {
                    alert('Please add at least one process before comparing algorithms');
                    return;
                }
                
                // Show loading
                this.ui.showLoading('comparisonContainer');
                
                try {
                    // Convert processes to CPUScheduling Process objects
                    const processes = this.ui.state.processes.map(p => 
                        new CPUScheduling.Process(p.id, p.arrivalTime, p.burstTime, p.priority)
                    );
                    
                    // Run comparison
                    const comparison = CPUScheduling.runAll(processes, this.ui.state.timeQuantum);
                    
                    // Store results
                    this.ui.state.comparisonResults = comparison;
                    
                    // Render comparison
                    this.visualizer.renderComparison(comparison, 'comparisonContainer');
                    
                    // Also run individual simulation for the selected algorithm
                    await this.runSimulation();
                    
                } catch (error) {
                    console.error('Comparison error:', error);
                    alert(`Error comparing algorithms: ${error.message}`);
                    
                    // Show error state
                    document.getElementById('comparisonContainer').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <h3>Comparison Error</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // ============================================
        // 5. INITIALIZATION
        // ============================================
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Check if CPUScheduling module is available
            if (typeof CPUScheduling === 'undefined') {
                alert('Error: CPUScheduling module not found. Please make sure cpuScheduling.js is loaded.');
                return;
            }
            
            // Initialize the simulator
            window.simulator = new SimulationController();
            window.ui = simulator.ui;
            
            // Set initial algorithm selection
            document.getElementById('algorithmSelect').value = simulator.ui.state.currentAlgorithm;
            simulator.ui.updateAlgorithmUI();
            
            // Add some sample data if empty
            if (simulator.ui.state.processes.length === 0) {
                // Auto-load sample data for demo
                setTimeout(() => {
                    simulator.ui.state.loadSampleProcesses();
                    simulator.ui.renderProcessTable();
                    
                    // Show welcome message
                    document.getElementById('resultsContainer').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <i class="fas fa-rocket" style="font-size: 3rem; margin-bottom: 20px; color: var(--primary-color);"></i>
                            <h3 style="color: var(--primary-color);">Welcome to CPU Scheduling Simulator!</h3>
                            <p>Sample processes have been loaded. You can:</p>
                            <ul style="text-align: left; max-width: 400px; margin: 20px auto;">
                                <li>Modify process parameters</li>
                                <li>Add new processes</li>
                                <li>Select different algorithms</li>
                                <li>Run simulations</li>
                                <li>Compare algorithm performance</li>
                            </ul>
                            <button onclick="simulator.runSimulation()" class="btn btn-primary" style="margin-top: 20px;">
                                <i class="fas fa-play-circle"></i> Run First Simulation
                            </button>
                        </div>
                    `;
                }, 500);
            }
            
            console.log('CPU Scheduling Simulator initialized successfully!');
        });

        // ============================================
        // 6. UTILITY FUNCTIONS
        // ============================================
        // Export data function
        function exportData() {
            const data = {
                processes: simulator.ui.state.processes,
                algorithm: simulator.ui.state.currentAlgorithm,
                timeQuantum: simulator.ui.state.timeQuantum,
                results: simulator.ui.state.results ? simulator.ui.state.results.toDict() : null,
                comparison: simulator.ui.state.comparisonResults
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cpu-scheduling-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Import data function
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    simulator.ui.state.processes = data.processes || [];
                    simulator.ui.state.currentAlgorithm = data.algorithm || 'fcfs';
                    simulator.ui.state.timeQuantum = data.timeQuantum || 2;
                    
                    // Update UI
                    simulator.ui.renderProcessTable();
                    document.getElementById('algorithmSelect').value = simulator.ui.state.currentAlgorithm;
                    simulator.ui.updateAlgorithmUI();
                    
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data: Invalid file format');
                }
            };
            reader.readAsText(file);
        }
        
        // Add export/import buttons to footer
        document.addEventListener('DOMContentLoaded', () => {
            const footer = document.querySelector('.footer');
            footer.innerHTML += `
                <div style="margin-top: 15px;">
                    <button onclick="exportData()" class="btn" style="background: var(--gray-color); color: white; margin: 5px;">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <label for="importFile" class="btn" style="background: var(--accent-color); color: white; margin: 5px; cursor: pointer;">
                        <i class="fas fa-upload"></i> Import Data
                    </label>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            `;
        });
    </script>
    <script src="./cpuScheduling.js"></script>   <!-- same folder -->
<script src="./js/cpuScheduling.js"></script> <!-- inside js folder -->

</body>
</html>